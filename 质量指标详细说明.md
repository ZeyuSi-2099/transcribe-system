# 笔录转换质量指标详细说明

## 概述
本系统采用多维度质量评估体系，对笔录转换结果进行全面的质量分析。评估体系包含基础统计、内容保持、语言质量、结构化指标等多个维度。

## 指标分类与算法

### 1. 基础统计指标 (Basic Metrics)

#### 1.1 字符统计 (character_count)
- **原始字符数 (original)**: 原始文本的字符总数
- **转换后字符数 (converted)**: 转换后文本的字符总数  
- **字符保留率 (retention_rate)**: `转换后字符数 / 原始字符数`
- **算法**: 直接统计字符串长度

#### 1.2 词数统计 (word_count)
- **原始词数 (original)**: 原始文本按空格分割的词数
- **转换后词数 (converted)**: 转换后文本按空格分割的词数
- **词数保留率 (retention_rate)**: `转换后词数 / 原始词数`
- **算法**: `len(text.split())`

#### 1.3 压缩比率 (compression_ratio)
- **字符级压缩率**: `(原始字符数 - 转换后字符数) / 原始字符数`
- **词级压缩率**: `(原始词数 - 转换后词数) / 原始词数`
- **算法**: 计算文本压缩程度，正值表示压缩，负值表示扩展

### 2. 内容保持指标 (Content Preservation)

#### 2.1 实体保留率 (entity_preservation_rate)
- **算法**: 
  1. 提取原始文本中的实体（人名、地名、时间、数字等）
  2. 提取转换后文本中的实体
  3. 计算保留的实体数量占原始实体数量的比例
- **实体识别规则**:
  - 时间表达式: `\d{1,2}[点时](\d{1,2}分?)?`、`昨天|今天|明天`等
  - 数字: `\d+`
  - 专有名词: 大写字母开头的词汇

#### 2.2 关键词保留率 (keyword_preservation_rate)
- **算法**:
  1. 提取原始文本关键词（去除停用词后的高频词）
  2. 提取转换后文本关键词
  3. 计算交集占原始关键词的比例
- **关键词提取**: 基于词频统计，排除常见停用词

#### 2.3 语义相似度 (semantic_similarity)
- **算法**: 使用 `difflib.SequenceMatcher` 计算文本相似度
- **公式**: `SequenceMatcher(None, text1, text2).ratio()`
- **范围**: 0-1，1表示完全相同

#### 2.4 综合内容保持率 (overall_preservation)
- **算法**: `(实体保留率 + 关键词保留率 + 语义相似度) / 3`

### 3. 语言质量指标 (Language Quality)

#### 3.1 第一人称一致性 (first_person_consistency)
- **目标**: 评估文本是否成功转换为第一人称表述
- **算法**:
  1. 统计第一人称代词: `我|我们|咱们|本人`
  2. 统计第二人称代词: `你|您|你们|大家`
  3. 统计第三人称代词: `他|她|它|他们|她们|它们`
  4. 计算第一人称占比: `第一人称数量 / 总代词数量`
- **评分**: 第一人称占比越高，分数越高（最大1.0）

#### 3.2 连贯性评分 (coherence_score)
- **算法**:
  1. **连接词密度**: 统计连接词使用频率
     - 连接词列表: `然后|接着|后来|之后|因此|所以|但是|不过|而且|同时`
     - 密度 = `连接词数量 / 句子数量`
  2. **句子长度一致性**: 
     - 计算句子长度方差
     - 一致性 = `1 / (1 + 方差/100)`
  3. **综合评分**: `连接词密度 × 0.6 + 长度一致性 × 0.4`

#### 3.3 流畅度评分 (fluency_score)
- **算法**:
  1. **重复词汇检查**: 统计5个词内的重复
  2. **不完整句子检查**: 识别过短句子（<3字符）
  3. **流畅度计算**: `max(0, 1 - 问题数量 / 总元素数量)`

#### 3.4 冗余度评分 (redundancy_score)
- **算法**:
  1. 计算句子间相似度（使用 `difflib.SequenceMatcher`）
  2. 识别高相似度句子（相似度 > 0.7）
  3. 冗余度 = `1 - 平均相似度`
- **评分**: 冗余度越低，分数越高

#### 3.5 综合语言质量 (overall_language_quality)
- **算法**: `(第一人称一致性 + 连贯性 + 流畅度 + 冗余度) / 4`

### 4. 结构化指标 (Structure Metrics)

#### 4.1 对话轮次分析 (dialogue_turns)
- **识别标记**: `问：|答：|访谈者：|被访者：`
- **减少率**: `(原始轮次 - 转换后轮次) / 原始轮次`

#### 4.2 句子数量分析 (sentences)
- **分割规则**: 按 `[。！？]` 分割
- **变化率**: `(转换后句子数 - 原始句子数) / 原始句子数`

#### 4.3 段落结构分析 (paragraphs)
- **分割规则**: 按 `\n\n` 分割
- **变化率**: `(转换后段落数 - 原始段落数) / 原始段落数`

### 5. 综合评分算法 (Overall Score)

#### 5.1 权重分配
```python
quality_weights = {
    "word_retention_rate": 0.25,      # 字数保留率
    "content_preservation": 0.30,     # 内容保持率  
    "coherence_score": 0.20,          # 连贯性评分
    "first_person_consistency": 0.15, # 第一人称一致性
    "redundancy_reduction": 0.10       # 冗余减少率
}
```

#### 5.2 计算公式
```
综合评分 = Σ(各指标得分 × 对应权重) × 100
```

#### 5.3 评级标准
- **90-100分**: 优秀 (绿色)
- **80-89分**: 良好 (蓝色)  
- **70-79分**: 中等 (橙色)
- **60-69分**: 及格 (黄色)
- **0-59分**: 需要改进 (红色)

### 6. 质量报告生成

#### 6.1 自动建议算法
- **字数保留率 < 0.7**: "文本压缩过度，可能丢失了重要信息"
- **字数保留率 > 0.95**: "文本压缩不足，可以进一步精简"
- **内容保持率 < 0.8**: "关键信息保留不足，建议检查实体和关键词"
- **连贯性 < 0.7**: "文本连贯性有待提升，建议增加连接词"
- **第一人称一致性 < 0.8**: "第一人称转换不够彻底，存在其他人称表述"

#### 6.2 报告内容
- 质量等级和颜色标识
- 综合评分
- 改进建议列表
- 质量摘要

### 7. 规则应用信息 (Rule Application)

#### 7.1 前处理规则 (preprocessing_rules)
- 记录应用的前处理规则列表
- 包含规则ID、名称、类型

#### 7.2 后处理规则 (postprocessing_rules)  
- 记录应用的后处理规则列表
- 包含规则ID、名称、类型

#### 7.3 转换摘要 (conversion_summary)
- **处理时间**: 转换耗时（秒）
- **应用规则数**: 总共应用的规则数量
- **处理阶段**: 详细的处理步骤信息

## 使用说明

1. **实时计算**: 每次转换完成后自动计算所有指标
2. **权重可调**: 可根据业务需求调整各指标权重
3. **扩展性**: 支持添加新的质量评估维度
4. **可视化**: 前端以用户友好的方式展示各项指标

## 技术实现

- **语言**: Python
- **主要库**: `re`, `difflib`, `loguru`
- **服务类**: `QualityService`
- **异步支持**: 支持异步计算提升性能
- **错误处理**: 完善的异常处理和日志记录 